<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>云医院</title>
		<link rel="stylesheet" href="layui/css/layui.css">
		<link rel="stylesheet" href="css/main.css" />
		<script src="js/jquery-3.5.1.min.js"></script>
		<script type="text/JavaScript" src="js/jquery-3.5.1.js" charset="utf-8"></script>
		<script>

		</script>
	</head>
	<body class="layui-layout-body">
		<div class="layui-layout layui-layout-admin">
			<div class="layui-header box-shadow" style="background-color: white;">
				<div class="layui-logo" style="background-color: #393D49;color: white;">东软云医院HIS系统</div>
				<ul class="layui-nav layui-layout-right">
					<li class="layui-nav-item">
						<a id="t1" href="javascript:;" class="layui-icon layui-icon-username" style="color: black;">
							{{name}}
						</a>
						<!-- <dl class="layui-nav-child" style="color: black;">
							<dd><a href="">基本资料</a></dd>
							<dd><a href="">安全设置</a></dd>
						</dl> -->
					</li>
					<li class="layui-nav-item"><a href="index.html" class="layui-icon layui-icon-logout" style="color: black;">退出</a></li>
				</ul>
			</div>

			<div class="layui-side layui-bg-black">
				<div class="layui-side-scroll">
					<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
					<ul class="layui-nav layui-nav-tree" lay-filter="test">
						<hr class="layui-bg-green" style="height: 5px;" />
						<li class="layui-nav-item layui-nav-itemed">
							<a href="javascript:;">挂号收费</a>
							<dl class="layui-nav-child">
								<dd><a href="javascript:;">新患者</a></dd>
								<dd><a href="javascript:;">旧患者</a></dd>
							</dl>
						</li>
						<li class="layui-nav-item">
							<a href="mainYJ.html">医技处置</a>
						</li>
						<li class="layui-nav-item">
							<a href="javascript:;">药房管理</a>
							<dl class="layui-nav-child">
								<dd><a href="mainYF.html">药房发药</a></dd>
								<dd><a href="mainYG.html">管理药品</a></dd>
							</dl>
						</li>
						<li class="layui-nav-item">
							<a href="mainKS.html">科室管理</a>
						</li>
					</ul>
				</div>
			</div>

			<div class="layui-body">
				<div id="box" style="margin-top:0px;">
					<!-- 内容主体区域 -->
					<!-- 新患者 -->
					<div id="G1" style="padding: 15px; background-color: #F2F2F2;display: block;">
						<div class="layui-row layui-col-space15">
							<div class="layui-col-md12">
								<div class="layui-card" style="box-shadow: 5px 5px 5px -5px #2F4056;">
									<div class="layui-card-header">基本信息</div>
									<div class="layui-card-header">病历号：{{lis.pid+1}}</div>
									<div class="layui-card-body">
										<!-- 信息部分 -->
										<form class="layui-form" action="" lay-filter="g1">
											<div class="layui-form-item">
												<label class="layui-form-label">姓名</label>
												<div class="layui-input-block">
													<input type="text" name="name" lay-verify="required|title" autocomplete="off" placeholder="请输入姓名" class="layui-input">
												</div>
											</div>

											<div class="layui-form-item">
												<label class="layui-form-label">身份证</label>
												<div class="layui-input-block">
													<input type="text" name="cardId" lay-verify="required|title" autocomplete="off" placeholder="请输入身份证" class="layui-input">
												</div>
											</div>

											<div class="layui-form-item">
												<label class="layui-form-label">挂号级别</label>
												<div class="layui-input-block">
													<select name="level" lay-filter="">
														<option value=""></option>
														<option value="普通号">普通号</option>
														<option value="专家号">专家号</option>
														<option value="急诊号">急诊号</option>
													</select>
												</div>
											</div>

											<div class="layui-form-item">
												<label class="layui-form-label">性别</label>
												<div class="layui-input-block">
													<input type="radio" name="sex" value="男" title="男" checked="">
													<input type="radio" name="sex" value="女" title="女">
												</div>
											</div>

											<div class="layui-form-item">
												<div class="layui-inline">
													<label class="layui-form-label">出生日期</label>
													<div class="layui-input-block">
														<input type="text" name="date" id="date1" autocomplete="off" class="layui-input">
													</div>
												</div>
												<div class="layui-inline">
													<label class="layui-form-label">手机号码</label>
													<div class="layui-input-inline">
														<input type="tel" name="phonenumber" lay-verify="required|phone" autocomplete="off" class="layui-input">
													</div>
												</div>

												<div class="layui-inline">
													<label class="layui-form-label">结算类别</label>
													<div class="layui-input-inline">
														<select name="payKind" lay-verify="required" lay-search="">
															<option value="">请选择类别</option>
															<option value="自费">自费</option>
															<option value="医保">医保</option>
															<option value="新农合">新农合</option>
														</select>
													</div>
												</div>
											</div>
											<div class="layui-form-item">
												<label class="layui-form-label">挂号科室及医生</label>
												<div class="layui-input-inline">
													<select name="office" id="g1_select1" lay-filter="g1_select1">
														<option value="">请选择科室</option>
													</select>
												</div>
												<div class="layui-input-inline">
													<select name="doctor" id="g1_select2">
														<option value="">请选择医生</option>
													</select>
												</div>
											</div>



											<div class="layui-form-item">
												<div class="layui-input-block" style="text-align: center;">
													<button type="submit" class="layui-btn" lay-submit="" lay-filter="g1_list">立即挂号</button>
												</div>
											</div>
										</form>
										<!-- ----- -->
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- 旧患者 -->
					<div id="G2" style="padding: 15px; background-color: #F2F2F2;display: none;">
						<div class="layui-row layui-col-space15">
							<div class="layui-col-md12">
								<div class="layui-card" style="box-shadow: 5px 5px 5px -5px #2F4056;">
									<div class="layui-card-header">基本信息</div>
									<div class="layui-card-body">
										<form class="layui-form" action="">
											<div class="layui-form-item">
												<label class="layui-form-label">病历号</label>
												<div class="layui-input-block">
													<input type="text" name="pid" lay-verify="pid-check" autocomplete="off" placeholder="请输入病历号" class="layui-input">
												</div>
											</div>

											<div class="layui-form-item">
												<label class="layui-form-label">挂号级别</label>
												<div class="layui-input-block">
													<select name="level" lay-filter="level">
														<option value=""></option>
														<option value="普通号">普通号</option>
														<option value="专家号">专家号</option>
														<option value="急诊号">急诊号</option>
													</select>
												</div>
											</div>

											<div class="layui-form-item">
												<label class="layui-form-label">验证身份证</label>
												<div class="layui-input-block">
													<input type="text" name="cardId" lay-verify="identity" placeholder="请输入注册的身份证" autocomplete="off" class="layui-input">
												</div>
											</div>

											<div class="layui-inline layui-form-item">
												<label class="layui-form-label">结算类别</label>
												<div class="layui-input-inline">
													<select name="payKind" lay-verify="required" lay-search="">
														<option value="">请选择类别</option>
														<option value="自费">自费</option>
														<option value="医保">医保</option>
														<option value="新农合">新农合</option>
													</select>
												</div>
											</div>

											<div class="layui-form-item">
												<label class="layui-form-label">挂号科室及医生</label>
												<div class="layui-input-inline">
													<select name="office" id="g1_select3" lay-filter="g1_select3">
														<option value="">请选择科室</option>
													</select>
												</div>
												<div class="layui-input-inline">
													<select name="doctor" id="g1_select4">
														<option value="">请选择医生</option>
													</select>
												</div>
											</div>

											<div class="layui-form-item">
												<div class="layui-input-block">
													<button type="submit" class="layui-btn" lay-submit="" lay-filter="g2_list">立即挂号</button>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
			<script src="js/vue.js"></script>
			<script src="layui/layui.js"></script>
			<script>
				// JavaScript代码区域
				layui.use('form', function() {
					var form = layui.form;
					window.onload = function() {
						//js 控制html元素
						//dom模型:文档对象模型
						//获取select标签
						let sts1 = document.querySelector("#g1_select1")
						let sts2 = document.querySelector("#g1_select2")
						let sts3 = document.querySelector("#g1_select3")
						let sts4 = document.querySelector("#g1_select4")
						//存储省份
						let office = ["心血管科", "妇科", "幼儿科"]
						//存储城市
						let doctor = [
							["张医生", "王医生", "李医生"],
							["郑医生", "安医生"],
							["济公", "华佗", "扁鹊"]
						]
						
						for (let i in office) {
							//??为什么不用变量声明
							let office1 = office[i]
							//生成option的html标记
							let p = document.createElement("option")
							let p1 = document.createElement("option")
							//##
							p.value = i
							p.innerText = office1
							p1.value = i
							p1.innerText = office1

							// console.log(p)
							sts3.appendChild(p1)
							sts1.appendChild(p)
						}
						form.render()
						//第一个下拉列表被选择后,选择执行之后的事件
						form.on('select(g1_select1)', function(data){
						  
						   //##清空上一次的城市结果
						   sts2.options.length = 1
						   //获取被选择的那一项
						   let c = doctor[data.value]
						   console.log(c)
						   //将定位到的城市生成html标记
						   for (let ci in c) {
						   	let pc = document.createElement("option")
						   	pc.innerText = c[ci]
						   	sts2.appendChild(pc)
						   } 
						   console.log(sts2)
						   form.render()
						});
						console.log(sts3)
						form.on('select(g1_select3)', function(data){
						  console.log(sts3)
						   //##清空上一次的城市结果
						   sts4.options.length = 1
						   //获取被选择的那一项
						   let c = doctor[data.value]
						  
						   //将定位到的城市生成html标记
						   for (let ci in c) {
						   	let pc = document.createElement("option")
						   	pc.innerText = c[ci]
						   	sts4.appendChild(pc)
						   } 
						   
						   form.render()
						});
						form.render()
					}
				});

				layui.use('element', function() {
					var element = layui.element;
					//导航栏监听
					element.on('nav(test)', function(elem) {
						console.log(elem[0].textContent); //得到当前点击的DOM对象
						if (elem[0].textContent == "新患者") {
							document.getElementById("G2").style.display = "none";
							document.getElementById("G1").style.display = "block";
						} else
						if (elem[0].textContent == "旧患者") {
							document.getElementById("G1").style.display = "none";
							document.getElementById("G2").style.display = "block";
						} else {
							document.getElementById("G2").style.display = "none";
							document.getElementById("G1").style.display = "none";
						}
					});
				});


				let v = new Vue({
					el: '#box',
					data: {
						lis: 0,
					},
					methods: {
						initData: function() {
							let self = this
							//访问本地的json文件
							$.getJSON("json/m-record.json", function(data) {
								self.lis = data[data.length - 1]
							})
						}
					},
					created: function() {
						//窗体加载后执行自动执行的代码块
						this.initData()
					}
				});
				let t = new Vue({
					el: '#t1',
					data: {
						name: "",
						psw: ""
					},
					methods: {
						initDat: function() {
							var url = location.search; //获取url中"?"符后的字串
							var theRequest = new Object();
							var request = new Object();
							if (url.indexOf("?") != -1) {
								var str = url.substr(1);
								strs = str.split("&");
								for (var i = 0; i < strs.length; i++) {
									theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
								}
							};
							request = theRequest;
							this.name = request['name'];
							this.psw = request['psw'];
						}
					},
					created: function() {
						//窗体加载后执行自动执行的代码块
						this.initDat()
					}
				});

				layui.use(['form', 'layedit', 'laydate'], function() {
					var form = layui.form,
						layer = layui.layer,
						layedit = layui.layedit,
						laydate = layui.laydate;

					//日期
					laydate.render({
						elem: '#date'
					});
					laydate.render({
						elem: '#date1'
					});

					//创建一个编辑器
					var editIndex = layedit.build('LAY_demo_editor');

					//自定义验证规则
					form.verify({
						title: function(value) {

						},
						pass: [
							/^[\S]{6,12}$/, '密码必须6到12位，且不能出现空格'
						],
						content: function(value) {
							layedit.sync(editIndex);
						}
					});

					//监听指定开关
					form.on('switch(switchTest)', function(data) {
						layer.msg('开关checked：' + (this.checked ? 'true' : 'false'), {
							offset: '6px'
						});
						layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
					});

					//g1监听提交
					form.on('submit(g1_list)', function(data) {
						$.getJSON("json/m-record.json", function(data1) {
							data.field.pid = data1.length
							data1.push(data.field)
							layer.alert("挂号成功")

							//更新pid
							$.getJSON("json/m-record.json", function(data2) {
								v.lis = data2[data2.length - 1]
							})
						});
						return false;
					});
					//g2监听提交
					form.on('submit(g2_list)', function(data) {
						$.getJSON("json/m-record.json", function(data1) {
							var j = 0;
							for (let i = 0; i < data1.length; i++) {
								if (data1[i].cardId == data.field.cardId && data1[i].pid == data.field.pid) {
									j = 1;
								}
							};
							if (j == 1) {
								j = 0;
								layer.alert("挂号成功")
							} else {
								layer.alert("病历号/身份证输入错误")
							}
						});

						return false;
					});

				});
			</script>
	</body>
</html>
